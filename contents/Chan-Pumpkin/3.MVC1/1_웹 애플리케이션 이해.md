# 1. 웹 서버, 웹 애플리케이션 서버

웹이라는 것은 HTTP 기반으로 통신을 함.

예를 들어서 웹 브라우저 클라이언트에서 URL 치면 인터넷 통해서 서버에 접근을 하고, 서버에서 HTML을 만들어서 클라이언트에 내려줌

클라이언트에서 데이터 전송할 때, 서버에서 클라이언트에 데이터 응답할 때, HTTP 기반으로 보냄

- HTML
- TEXT
- 이미지, 음성, 영상
- 파일
- JSON, XML (API)
- 거의 모든 형태의 데이터 전송 가능
- 서버간에 데이터를 주고 받을 때도 대부분 HTTP 사용

## 웹 서버

- HTTP 기반으로 동작
- 정적 리소스, 기타 부가 기능 제공
- 정적 HTML, CSS, JS, 이미지, 영상 등을 HTTP로 웹서버에 요청해서 HTTP프로토콜로 응답 받는 것
- 정적 데이터들을 제공하는 것
- 웹 서버 종류: NGINX, APACHE

## WAS(Web Application Server)

- HTTP 기반으로 동작
- 웹 서버의 기능을 포함 (정적 리소스 제공 가능)
- 차이 : 프로그램 코드를 실행해서 애플리케이션 로직 수행
- 웹서버는 정적인 파일을 서로 주고받기 때문에 특정 사용자마다 다르게 보여줄 수 없음. 근데 WAS는 HTTP 요청이 오면 사용자에 따라서 다르게 화면을 보여줄 수가 있음. 프로그램 코드를 실행할 수 있기 때문에
- WAS로 통해서 동적 HTML, HTTP API(JSON) 제공됨.
- 서블릿, JSP, 스프링 MVC는 WAS에서 동작함.
- WAS 종류: 톰캣(Tomcat) Jetty, Undertow

## 웹 서버, WAS 차이

### 사실 둘 경계가 애매하다?

- 웹 서버도 프로그램을 실행하는 기능을 포함하기도 함.
- 웹 어플리케이션 서버도 웹 서버의 기능을 제공함.
- 자바는 서블릿 컨테이너 기능을 제공하면 WAS라고 하지만, 서블릿 없이 자바 코드를 실행하는 서버 프레임워크도 있음

### 그래서 이렇게 차이를 정리하는게 좋다!

- 웹 서버는 정적 리소스, WAS는 애플리케이션 로직
- WAS는 애플리케이션 코드를 실행하는데 더 특화

## 웹 시스템 구성 WAS, DB의 현실

WAS는 정적 리소스, 애플리케이션 로직 모두 제공 가능하기 때문에, WAS, DB만으로 시스템 구성이 가능하다.

### 하지만,

- WAS가 너무 많은 역할을 담당하게 되면, 서버 과부하 우려
- HTML, CSS, JS 간단하게 실행할 수 있기에 값이 싸다 하지만 애플리케이션 로직같은 경우에는 값이 비싸다 그런 값 비싼 중요한 애플리케이션 로직이 정적 리소스 때문에 수행이 어려울 수 있음.
- WAS 장애시 오류 화면도 노출 불가능
- 실제로 WAS는 잘 죽는다

## 웹 시스템 구성 WEB, WAS, DB

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/45175980-4ce8-482e-a453-9ae1556cc85a/Untitled.png)

웹 서버를 앞에 두고 정적인 리소스를 처리함.

그러다가 동적인 로직이 필요하면 뒤로 넘겨서 WAS에게 전달함.

### 장점

- 웹 서버는 애플리케이션 로직 같은 동적인 처리가 필요하면 WAS에 요청 위임해서 WAS는 중요한 애플리케이션 로직 처리를 전담한다.
- 정적 리소스가 많이 사용되면 WEB 서버 증설하면 되고, 애플리케이션 리소스가 많이 사용되면 WAS 서버 증설하면 됨
- 정적 리소스만 제공하는 웹 서버는 잘 죽지 않음 폴더를 두고 URL이 들어오면 해당 폴더의 파일을 제공하면 되기 때문에
- 애플리케이션 로직이 동작하는 WAS 서버는 잘 죽어서, WEB 서버에서 WAS에서 요청할 때 응답이 없으면 WEB 서버가 오류 화면 제공 가능하다. 즉 WAS, DB 장애시 WEB 서버가 오류 화면을 제공함.

다만 데이터만 제공하게 되면 굳이 WEB 서버가 없어도 됨.

# 2. 서블릿

## HTML Form 데이터 전송

1) 전송

2) 웹 브라우저가 HTTP 메시지를 만들어서 서버에 전송함.

### 만약에 웹 애플리케이션 서버를 직접 다 구현해야한다면?

우선 HTTP 메시지를 쭉 다 풀어 헤쳐야함.

> 다음과 같은 과정이 있다.
> 
> - 서버 TCP/IP 연결 대기, 소켓 연결
> - HTTP 요청 메시지를 파싱해서 읽기
> - POST 방식, /save URL 인지
> - Content-Type 확인
> - HTTP 메시지 바디 내용 파싱
> - username, age 데이터를 사용할 수 있게 파싱
> - 저장 프로세스 실행
> - 비즈니스 로직 실행
> - 데이터베이스에 저장 요청
> - HTTP 응답 메시지 생성 시작
> - HTTP 시작 라인 생성
> - Header 생성
> - 메시지 바디에 HTML 생성에서 입력
> - TCP/IP에 응답 전달, 소켓 종료

웹 애플리케이션 서버를 위 같은 과정을 신경 쓰기엔 너무 많다 그래서 서블릿이라는 것이 나옴

서블릿은 위 과정에서 아래 과정을 제외한 모든 과정을 지원해준다.

- 비즈니스 로직 실행
- 데이터베이스에 저장 요청

서블릿을 지원하는 WAS에서 다 해준다.

## 서블릿 특징

```java
@WebServlet(name = "helloServlet", urlPatterns = "/hello") 
public class HelloServlet extends HttpServlet { 
 @Override 
 protected void service(HttpServletRequest request, HttpServletResponse response){ 
 //애플리케이션 로직
 } 
}
```

- urlPatterns(/hello)의 URL이 호출되면 서블릿 코드가 실행
- HTTP 요청 정보를 편리하게 사용할 수 있는 HttpServletRequest
- HTTP 응답 정보를 편리하게 제공할 수 있는 HttpServletResponse
- 개발자는 HTTP 스펙을 매우 편리하게 사용
- 코드만 만들면 된다. WAS안에 서블릿 컨테이너가 있는데 자동으로 생성해주고, 호출해주고, 생명주기 관리해줌.

## 과정

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2dafb668-8d08-4226-b0ef-b1b0f91dd798/Untitled.png)

1) 웹 브라우저에서 [localhost:8080](http://localhost:8080)/hello 요청

2) WAS 서버에서 HTTP 요청 메시지를 기반으로 request, response 객체를 만듬

3) request, response를 파라미터로 넘기면서 helloServlet를 실행함

4) helloServlet 실행 끝나고 리턴하면, response 객체 정보로 HTTP 응답을 생성해서 웹 브라우저에 전송

## 서블릿 컨테이너

싱글톤 : 객체를 하나 생성해놓고 공유해서 사용

- 톰캣처럼 서블릿을 지원하는 WAS를 서블릿 컨테이너라고 한다
- 서블릿 컨테이너는 서블릿 객체를 생성, 초기화, 호출, 종료하는 생명주기 관리
- 서블릿 객체는 싱글톤으로 관리
싱글톤 : 객체를 하나 생성해놓고 공유해서 사용
• 고객의 요청이 올 때 마다 계속 객체를 생성하는 것은 비효율
• 최초 로딩 시점에 서블릿 객체를 미리 만들어두고 재활용
• 모든 고객 요청은 동일한 서블릿 객체 인스턴스에 접근
• 공유 변수 사용 주의
• 서블릿 컨테이너 종료시 싱글톤도 함께 종료
- JSP도 서블릿으로 변환 되어서 사용
- 동시 요청을 위한 멀티 쓰레드 처리 지원
