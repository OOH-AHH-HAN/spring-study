# 3. TCP

ip패킷의 문제를 TCP 프로토콜이 해결해준다.

UDP는 해결은 해주지는 않지만 도움되는 것들이 있다. 

## 인터넷 프로토콜 스택의 4계층
![Untitled](https://user-images.githubusercontent.com/62877858/209468414-ffbe1900-5fba-4f7c-ba4b-a64cbf5ac81c.png)

여기서 IP 위에 올려서 TCP가 보완을 해주는 역할이라고 생각하면 된다.

## 프로토콜 계층
![Untitled 1](https://user-images.githubusercontent.com/62877858/209468417-06c23bde-2d49-4d38-a88c-b0de59c0acda.png)

### 프로토콜 계층 순서

채팅 프로그램으로 친구에게 메시지를 보내고 싶다.

1) 애플리케이션의 채팅프로그램으로 메시지를 보내면 SOCKET 라이브러리를 쓰게 되는데, SOCKET 라이브러리를 통해 OS계층에 메시지를 넘긴다.

2) TCP

OS계층에서 TCP 정보를 생성해서 메시지에 붙여서 IP에 넘긴다.

3) IP

IP관련된 패킷이 생성이 되어, 붙여서 넘긴다.

4) 네트워크 인터페이스

LAN카드로 통해서 나갈 때, Ethernet frame이라는 것이 있는데, 이것이 포함되서 나감.

Ethernet frame은 랜카드 안에 포함되어있는 MAC주소와 같은 실제 물리적인 정보들이 포함되어 있다.

## IP 패킷 정보

전송데이터 안에 출발지 IP, 목적지 IP를 덧붙여서 보냄

### 패킷이라는 단어란?

패킷은 패키지, 수화물, 덩어리 등의 합성어 택배박스와 같은 것

## TCP/IP 패킷 정보

- 출발지/목적지 포트가 들어감.
- 전송 제어관련된 정보
- 순서와 관련된 정보
- 검증 정보

## TCP 특징

전송 제어 프로토콜

전송을 어떻게 할지 제어를 한다는 의미

- 연결지향 - TCP 3 way handshake (가상 연결)

쟤랑 나랑 연결이 됐는지 확인하고 메시지를 보냄

상대방의 연결을 한다음에 메시지를 보냄

- 데이터 전달 보증

패킷이 중간에 누락이 된것을 알 수가 있음

- 순서 보장
- 신뢰할 수 있는 프로토콜
- 현재는 애플리케이션에서 대부분 TCP 사용

## TCP 3 Way handshake

TCP 프로토콜을 연결을 하게 되면

1. syn이라는 메시지를 보낸다.
2. 상대방이 ack를 보내면서 나도 연결해줘 하면서 syn+ack를 보낸다.
3. 상대방이 ack를 보냄
4. 데이터 전송

1,2,3 연결 과정

연결이 문제가 있다고 생각하면 데이터를 전송 안하게 된다. 사전에 미리 방지할 수 있음

요새 최적화가 되어서 3 ack를 보낼 때 데이터 전송을 보낸다.

syn: 접속 요청

ack: 요청 수락

물리적인 것이 아니다

논리적으로 연결 된 것이다.

개념적으로만 이해하면 된다.

## 데이터 전달 보증

TCP

데이터를 전송 하며 목적지에서 데이터를 잘 받았다고 보냄

## 순서 보장

1,2,3 순서로 전송

1,3,2 순서로 도착

목적지에서 패킷 2번부터 다시 보내 라고 함.

tcp는 전송제어 정보, 순서 정보, 검증 정보가 추가가 되어있음 그래서 가능한 것이다.

## UDP 특징

- TCP에 비해 기능이 거의 없음
- 연결지향-TCP 3 way handshake도 없음
- 데이터 전달 보증도 없음
- 순서 보장도 없음
- 데이터 전달 및 순서가 보장되지 않지만, 단순하고 빠름
- ip와 거의 같다 + 포트가 추가 됨.  + 체크섬 (이 메시지에 대해서 맞는지 검증)정도만 추가

### 포트라는 것이 무엇인가?

내 ip로 여러가지를 할 수 있는데 그 안에서 구분할 수 있는거

내 pc로 여러 애플리케이션을 할 수 있는데 이 애플리케이션을 구분하는 거

### UDP를 왜 쓰지라고 할 수 있다.

TCP 3 way handshake 시간 걸린다.

데이터 전달 보증 하면 시간 걸린다.

최적화하고싶은데 해도 할 수 없다.

인터넷이 다 TCP 기반으로 쓰고 있기 때문에 손을 못 댄다.

UDP는 아무것도 안되어있기 때문에 손을 댈 수가 있음.
