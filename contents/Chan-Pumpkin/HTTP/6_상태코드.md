# HTTP 상태코드

## 상태코드

클라이언트가 보낸 요청의 처리 상태를 응답에서 알려주는 기능

- 1xx(Informational): 요청이 수신되어 처리중
- 2xx(Successful): 요청 정상 처리
- 3xx(Redirection): 요청을 완료하려면 추가 행동이 필요
- 4xx(Client Error): 클라이언트 오류, 잘못된 문법등으로 서버가 요청을 수행할 수 없음
- 5xx(Server Error): 서버오류, 서버가 정상 요청을 처리하지 못함

클라이언트는 상위 상태코드로 해석해서 처리함.

ex) 243 → 2xx 요청 정상 처리

## 1xx(Informational)

요청이 수신되어 처리 중

- 거의 사용하지 않음.

# 2xx : 성공

클라이언트의 요청을 성공적으로 처리

거의 200만 사용만 하는 경우도 많음

200과 201만 사용하는 경우도 있음

개발할 때, 각 팀에서 범위를 정해놓고 사용하는게 좋다.

## 200 ok

1) 클라이언트에 get으로 요청

2) 서버가 응답 200 ok

## 201 create

post 처리

1) 클라이언트가 post로 신규 등록 처리 요청

2) 서버가 응답 코드로 201 Created, Location 생성된 리소스 넣어줌.

## 202 Aceepted

요청이 접수 되었지만, 처리가 완료되지 않음.

- 배치 처리 같은 곳에서 사용
- ex) 요청 접수 후 1시간 뒤에 배치 프로세스가 요청을 처리함

## 204 No Content

서버가 요청을 성공적으로 수행했지만, 응답 페이로드 본문에 보낼 데이터가 없음

- ex) 웹문서 편집기에서 저장 버튼 결과로 아무 내용이 없어도 된다.
저장만 하고 같은 화면을 유지해야할 때
- 결과 내용이 없어도 204 메시지만으로 성공을 인식할 수 있음.

# 3xx : 리다이렉션

- 요청을 완료하기 위해 추가적인 조치가 필요해서 클라이언트에게 다시 보내는 메시지
- 300번은 잘 안쓴다.

## 리다이렉션

웹 브라우저는 3xx 응답 결과에 Location 헤더가 있으면, Location 위치로 자동 이동 리다이렉트라고도 많이 함.

### 자동 리다이렉트 흐름

1) /old-event 요청

2) 301 메시지와 함께 Location : /new-event 응답

3) 자동 리다이렉트

4) /new-event 요청

5) 200 ok 응답

예전 URL를 요청을 했지만 현재 URL로 리다이렉트 해줄 때 사용

### 리다이렉트 종류

- 영구 리다이렉션

특정 리소스의 URI가 영구적으로 이동

완전히 바뀌어버린 경우에 사용할 수 있음.

ex) /old-event → /new-event

- 일시 리다이렉션

일시적으로 잠깐 변경할 때,

주문 완료 후 주문 내역 화면으로 이동

PRG: POST/Redirect/Get

- 특수 리다이렉션

1) 클라이언트가 캐시 만료 된 것을 확인하기 위해 서버에 정보를 넘김.

2) 서버가 결과 대신 캐시를 보냄

## 301 Moved Permanently: 영구 리다이렉션

- 리소스가 URI가 영구적으로 이동
- 원래의 URL을 사용하면 안된다는 거, 검색 엔진등에서도 변경 인지
- 리다이렉트시 요청 메서드가 GET으로 변하고, 본문이 제거될 수 있음(중요)

1) /old-event POST 사용 요청
name=pumpkin

age=20

2) 301 응답

Location: /new-event

3) 자동 리다이렉트

4) /new-event GET으로 요청

본문이 사라짐

5) 200 ok 응답

## 308 Permanent Redirect: 영구 리다이렉션

- 리소스가 URI가 영구적으로 이동
- 원래의 URL을 사용하면 안된다는 거, 검색 엔진등에서도 변경 인지
- 301과 기능은 같다.
- 리다이렉트시 요청 메서드와 본문 유지
- 처음 POST를 보내면 리다이렉트도 POST 유지

1) /old-event POST 사용 요청
name=pumpkin

age=20

2) 308 응답

Location: /new-event

3) 자동 리다이렉트

4) /new-event POST로 요청

name=pumpkin

age=20

5) 200 ok 응답

실무에서는 이렇게 사용 안함.

웬만하면 리다이렉션을 GET으로 돌린다.

POST로 다시 보내기엔 데이터를 다시 다 설정을 해야하기 때문에.

## 일시적인 리다이렉션

- 리소스의 URI가 일시적으로 변경
- 검색 엔진 등에서 URL을 변경하면 안됨

### 302 Found

- 리다이렉트시 요청 메서드가 GET으로 변하고, 본문이 제거될 수 있음(MAY)

### 307 Temporary Redirect

- 302와 기능은 같음
- 리다이렉트시 요청 메서드와 본문 유지
- 요청 메서드를 변경하면 안된다. (MUST NOT)

### 303 See Other

- 302와 기능은 같음
- 리다이렉트시 요청 메서드가 GET으로 변경(GET으로 무조건 변경함.)
- GET으로 조건 변경할 때는 303으로 사용함 하지만, 아직도 실무에서는 302를 쓴다.

### 302,307,303 정리

302 Found → GET으로 변할 수 있음

307 Temporary Redirect → 메서드가 변하면 안됨

303 See Other → 메서드가 GET으로 변경

### 역사

처음 302 스펙의 의도는 HTTP 메서드를 유지하는 것

웹 브라우저들이 대부분 GET으로 바꾸어버림(일부는 다르게 동작)

모호한 302를 대신 명확한 307, 303이 등장함(301 대응으로 308 등장)

### 현실

이미 많은 애플리케이션 라이브러리들이 302를 기본값으로 사용

자동 리다이렉션시 GET으로 변해도 되면 302를 사용해도 큰 문제 없음

그래도 307, 303을 권장함.

## PRG: POST/Redirect/Get

### POST로 주문후 웹 브라우저를 새로고침하면?

POST로 한번 더 들어가서 중복 주문이 들어갈 수 있음.

### PRG 사용전

1) /order 주문 POST 요청

2) 서버가 주문데이터 저장

3) 200 OK 응답 보냄

4) 결과 화면에서 새로고침

5) /order 주문 POST 요청

6) 서버가 주문데이터 저장

7) 200 OK 응답 보냄

### PRG 사용

- POST로 주문후에 새로 고침으로 인한 중복 주문 방지
- POST로 주문후에 주문 결과 화면을 GET 메서드로 다이렉트
- 새로고침해도 결과 화면을 GET으로 조회
- 중복 주문 대신에 결과 화면만 GET으로 다시 요청

### PRG 예시

1) /order 주문 POST요청

2) 서버가 주문데이터 저장

3) 302 Found 응답 보냄

Location: /order-result/25

4) 자동 리다이렉트

5) GET /order-result 요청

6) 주문데이터 조회 25번 주문

7) 200 OK 응답 보냄

- URL이 이미 POST→GET으로 리다이렉트
- 새로 고침 해도 GET으로 결과 화면만 조회

## 기타 리다이렉션: 300, 304

### 300 Multiple Choices: 안씀

### 304 Not Modified

- 캐시를 목적으로 사용
- 클라이언트에게 리소스가 수정되지 않았음을 알려줌
- 클라이언트는 로컬PC에 저장된 캐시를 재사용함 (캐시로 리다이렉트함.)
- 클라이언트에게 캐시를 사용하라고 요청함.
- 304 응답은 응답에 메시지 바디를 포함하면 안된다.
- 조건부 GET, HEAD 요청시 사용

# 4xx 클라이언트 오류

- 클라이언트의 요청에 잘못된 문법등으로 서버가 요청을 수행할 수 없음
- 오류의 원인이 클라이언트에 있음
- 클라이언트가 이미 잘못된 요청, 데이터를 보내고 있기 때문에, 똑같은 재시도가 실패함.
- 오류 불가능함.

### 400 Bad Request

- 클라이언트가 잘못된 요청을 해서 서버가 요청을 처리할 수 없음
- 클라이언트는 요청 내용을 다시 검토하고, 보내야함.
- 백엔드 개발자들은 철저하게 밸리데이션을 해서 클라이언트의 오류라는 것을 인지하도록 다 막아야한다.

### 401 Unauthorized

- 클라이언트가 해당 리소스에 대한 인증이 필요함
- 인증 되지 않음
- 401 오류 발생시 응답에 WWW-Authenticate 헤더와 함께 인증 방법을 설명
- 인증(Authentication): 본인이 누구인지 확인(로그인)
- 인가(Authorization): 권한부여 (특정 리소스에 접근할 수 있는 권한 인증이 있어야 인가가 있음 ex) admin)
- 오류 메시지가 Unauthorized 이지만 인증 되지 않음

### 403 Forbidden

- 서버가 요청을 이해했지만 승인을 거부함
- 주로 인증 자격 증명은 있지만, 접근 권한이 불충분한 경우

### 404 Not Found

- 요청 리소스를 찾을 수 없음
- 요청 리소스가 서버에 없음
- 또는 클라이언트가 권한이 부족한 리소스에 접근할 때 해당 리소스를 숨기고 싶을 때

# 5xx

- 서버 문제로 오류 발생
- 서버가 재시도 하면 성공할 가능성이 있음.
- 서버가 정말 터졌을 때만, 서버의 문제가 있을 때만 5xx대의 에러를 보내야 한다.

### 500 Internal Server Error

- 서버 내부의 오류 문제

### 503 Service Unavailable

- 서비스 이용불가
- 서버가 일시적인 과부하 또는 예정된 작업으로 잠시 요청을 처리할 수 없음
- Retry-After 헤더 필드로 얼마뒤에 복구되는지 보낼 수 있음
