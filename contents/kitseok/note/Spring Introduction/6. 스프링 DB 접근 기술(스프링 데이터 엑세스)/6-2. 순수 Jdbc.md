# ìˆœìˆ˜ Jdbc

### í™˜ê²½ ì„¤ì •

**build.gradle íŒŒì¼ì— jdbc, h2 ë°ì´í„°ë² ì´ìŠ¤ ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€**

spring-boot-starter-jdbc : JAVAì™€ DB ì—°ë™

com.h2database:h2 : h2DB í´ë¼ì´ì–¸íŠ¸

```xml
implementation 'org.springframework.boot:spring-boot-starter-jdbc'
runtimeOnly 'com.h2database:h2'
```

**ìŠ¤í”„ë§ ë¶€íŠ¸ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„¤ì • ì¶”ê°€**
[resources/application.properties]

```xml
#DB URL
spring.datasource.url=jdbc:h2:tcp://localhost/~/test
#H2 Driver
spring.datasource.driver-class-name=org.h2.Driver
#username
spring.datasource.username=sa
```

> ì£¼ì˜!: ìŠ¤í”„ë§ë¶€íŠ¸ 2.4ë¶€í„°ëŠ” spring.datasource.username=sa ë¥¼ ê¼­ ì¶”ê°€í•´ì£¼ì–´ì•¼ í•œë‹¤. 
ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ Wrong user name or password ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤. 
ì°¸ê³ ë¡œ ë‹¤ìŒê³¼ ê°™ì´ ë§ˆì§€ë§‰ì— ê³µë°±ì´ ë“¤ì–´ê°€ë©´ ê°™ì€ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.
spring.datasource.username=sa ê³µë°± ì£¼ì˜, ê³µë°±ì€ ëª¨ë‘ì œê±°í•´ì•¼ í•œë‹¤
> 

> ì°¸ê³ : ì¸í…”ë¦¬J ì»¤ë®¤ë‹ˆí‹°(ë¬´ë£Œ) ë²„ì „ì˜ ê²½ìš° application.properties íŒŒì¼ì˜ ì™¼ìª½ì´ ë‹¤ìŒ ê·¸ë¦¼ê³  ê°™ì´ íšŒìƒ‰ìœ¼ë¡œ ë‚˜ì˜¨ë‹¤. 
ì—”í„°í”„ë¼ì´ì¦ˆ(ìœ ë£Œ) ë²„ì „ì—ì„œ ì œê³µí•˜ëŠ” ìŠ¤í”„ë§ì˜ ì†ŒìŠ¤ ì½”ë“œë¥¼ ì—°ê²°í•´ì£¼ëŠ” í¸ì˜ ê¸°ëŠ¥ì´ ë¹ ì§„ ê²ƒì¸ë°, ì‹¤ì œ ë™ì‘í•˜ëŠ”ë°ëŠ” ì•„ë¬´ëŸ° ë¬¸ì œê°€ ì—†ë‹¤
> 
> 
> ![7-1](https://user-images.githubusercontent.com/78712704/208229660-105a7eda-2b74-4409-9605-5853526422dc.png)
> 

**Jdbc ë¦¬í¬ì§€í† ë¦¬ êµ¬í˜„**

<aside>
ğŸ’¡ ì£¼ì˜! ì´ë ‡ê²Œ JDBC APIë¡œ ì§ì ‘ ì½”ë”©í•˜ëŠ” ê²ƒì€ 20ë…„ ì „ ì´ì•¼ê¸°ì´ë‹¤. 
ë”°ë¼ì„œ ê³ ëŒ€ ê°œë°œìë“¤ì´ ì´ë ‡ê²Œ ê³ ìƒí•˜ê³  ì‚´ì•˜êµ¬ë‚˜ ìƒê°í•˜ê³ , 
ì •ì‹ ê±´ê°•ì„ ìœ„í•´ ì°¸ê³ ë§Œ í•˜ê³  ë„˜ì–´ê°€ì.

</aside>

**Jdbc íšŒì› ë¦¬í¬ì§€í† ë¦¬**

```java
package hello.hellospring.repository;
import hello.hellospring.domain.Member;
import org.springframework.jdbc.datasource.DataSourceUtils;
import javax.sql.DataSource;
import java.sql.*;
import java.util.ArrayList;
import java.util.List;
import java.util.Optional;
public class JdbcMemberRepository implements MemberRepository {
 private final DataSource dataSource;
 public JdbcMemberRepository(DataSource dataSource) {
 this.dataSource = dataSource;
 }
 @Override
 public Member save(Member member) {
 String sql = "insert into member(name) values(?)";
 Connection conn = null;
 PreparedStatement pstmt = null;
 ResultSet rs = null;
 try {
 conn = getConnection();
 pstmt = conn.prepareStatement(sql,
Statement.RETURN_GENERATED_KEYS);
 pstmt.setString(1, member.getName());
 pstmt.executeUpdate();
 rs = pstmt.getGeneratedKeys();
 if (rs.next()) {
 member.setId(rs.getLong(1));
 } else {
 throw new SQLException("id ì¡°íšŒ ì‹¤íŒ¨");
 }
 return member;
 } catch (Exception e) {
 throw new IllegalStateException(e);
 } finally {
 close(conn, pstmt, rs);
 }
 }
 @Override
 public Optional<Member> findById(Long id) {
 String sql = "select * from member where id = ?";
 Connection conn = null;
 PreparedStatement pstmt = null;
 ResultSet rs = null;
 try {
 conn = getConnection();
 pstmt = conn.prepareStatement(sql);
 pstmt.setLong(1, id);
 rs = pstmt.executeQuery();
 if(rs.next()) {
 Member member = new Member();
 member.setId(rs.getLong("id"));
 member.setName(rs.getString("name"));
 return Optional.of(member);
 } else {
 return Optional.empty();
 }
 } catch (Exception e) {
 throw new IllegalStateException(e);
 } finally {
 close(conn, pstmt, rs);
 }
 }
 @Override
 public List<Member> findAll() {
 String sql = "select * from member";
 Connection conn = null;
 PreparedStatement pstmt = null;
 ResultSet rs = null;
 try {
 conn = getConnection();
 pstmt = conn.prepareStatement(sql);
 rs = pstmt.executeQuery();
 List<Member> members = new ArrayList<>();
 while(rs.next()) {
 Member member = new Member();
 member.setId(rs.getLong("id"));
 member.setName(rs.getString("name"));
 members.add(member);
 }
 return members;
 } catch (Exception e) {
 throw new IllegalStateException(e);
 } finally {
 close(conn, pstmt, rs);
 }
 }
 @Override
 public Optional<Member> findByName(String name) {
 String sql = "select * from member where name = ?";
 Connection conn = null;
 PreparedStatement pstmt = null;
 ResultSet rs = null;
 try {
 conn = getConnection();
 pstmt = conn.prepareStatement(sql);
 pstmt.setString(1, name);
 rs = pstmt.executeQuery();
 if(rs.next()) {
 Member member = new Member();
 member.setId(rs.getLong("id"));
 member.setName(rs.getString("name"));
 return Optional.of(member);
 }
 return Optional.empty();
 } catch (Exception e) {
 throw new IllegalStateException(e);
 } finally {
 close(conn, pstmt, rs);
 }
 }
 private Connection getConnection() {
 return DataSourceUtils.getConnection(dataSource);
 }
 private void close(Connection conn, PreparedStatement pstmt, ResultSet rs)
{
 try {
 if (rs != null) {
 rs.close();
 }
 } catch (SQLException e) {
 e.printStackTrace();
 }
 try {
 if (pstmt != null) {
 pstmt.close();
 }
 } catch (SQLException e) {
 e.printStackTrace();
 }
 try {
 if (conn != null) {
 close(conn);
 }
 } catch (SQLException e) {
 e.printStackTrace();
 }
 }
 private void close(Connection conn) throws SQLException {
 DataSourceUtils.releaseConnection(conn, dataSource);
 }
}
```

**ìŠ¤í”„ë§ ì„¤ì • ë³€ê²½**

```java
package hello.hellospring;
import hello.hellospring.repository.JdbcMemberRepository;
import hello.hellospring.repository.JdbcTemplateMemberRepository;
import hello.hellospring.repository.MemberRepository;
import hello.hellospring.repository.MemoryMemberRepository;
import hello.hellospring.service.MemberService;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import javax.sql.DataSource;
@Configuration
public class SpringConfig {
 private final DataSource dataSource;
 public SpringConfig(DataSource dataSource) {
 this.dataSource = dataSource;
 }
 @Bean
 public MemberService memberService() {
 return new MemberService(memberRepository());
 }
 @Bean
 public MemberRepository memberRepository() {
// return new MemoryMemberRepository();
return new JdbcMemberRepository(dataSource);
 }
}
```

- DataSourceëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ì„ íšë“í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ê°ì²´ë‹¤.
ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ DataSourceë¥¼ ìƒì„±í•˜ê³  ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë§Œë“¤ì–´ë‘”ë‹¤. 
ê·¸ë˜ì„œ DIë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤.

**êµ¬í˜„ í´ë˜ìŠ¤ ì¶”ê°€ ì´ë¯¸ì§€**

![7-2](https://user-images.githubusercontent.com/78712704/208229666-35de7cf4-68fe-4779-b761-0dc119b85c53.png)

**ìŠ¤í”„ë§ ì„¤ì • ì´ë¯¸ì§€**

![7-3](https://user-images.githubusercontent.com/78712704/208229670-ffc2e877-e66e-48bb-bcdd-7a2a02183493.png)

 *** SOLID(ë‹¨ì¼ì±…ì„ì›ì¹™â€¦, ê°œë°©-íì‡„...) ì°¾ì•„ë³´ê¸°**

- ê°œë°©-íì‡„ ì›ì¹™(OCP, Open-Closed Principle)
    - **í™•ì¥ì—ëŠ” ì—´ë ¤ìˆê³ , ìˆ˜ì •, ë³€ê²½ì—ëŠ” ë‹«í˜€**ìˆë‹¤.
        
        (ê°ì²´ì§€í–¥ì„ ì‚¬ìš©)
        
- ìŠ¤í”„ë§ì˜ DI (**Dependencies Injection**)ì„ ì‚¬ìš©í•˜ë©´ ê¸°ì¡´ ì½”ë“œë¥¼ ì „í˜€ ì†ëŒ€ì§€ ì•Šê³ , ì„¤ì •ë§Œìœ¼ë¡œ êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.
- íšŒì›ì„ ë“±ë¡í•˜ê³  DBì— ê²°ê³¼ê°€ ì˜ ì…ë ¥ë˜ëŠ”ì§€ í™•ì¸í•˜ì.
- ë°ì´í„°ë¥¼ DBì— ì €ì¥í•˜ë¯€ë¡œ ìŠ¤í”„ë§ ì„œë²„ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•´ë„ ë°ì´í„°ê°€ ì•ˆì „í•˜ê²Œ ì €ì¥ëœë‹¤
